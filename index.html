<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××©×—×§ ×˜×¨×™×•×•×™×” ×‘×× ×’×œ×™×ª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the game */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as per instructions */
            background-color: #f0f9ff; /* Light blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Full viewport height */
            margin: 0;
            padding: 0.5rem; /* Reduced padding for mobile */
            box-sizing: border-box;
            overflow: hidden; /* Prevent scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling for iOS */
        }

        .game-container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* Rounded corners */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 1.5rem; /* Reduced padding for mobile */
            width: 100%;
            max-width: 500px; /* Max width for better readability on large screens */
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.8rem; /* Reduced overall gap for mobile */
            min-height: 95vh; /* Ensure it takes up most of the viewport height */
            justify-content: space-between; /* Distribute space vertically */
        }

        .button-primary {
            background-color: #6366f1; /* Indigo 500 */
            color: white;
            padding: 0.8rem 1.5rem; /* Reduced padding */
            border-radius: 0.75rem; /* Rounded corners */
            font-size: 1.1rem; /* Slightly smaller font size */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            width: 100%; /* Full width for better tap target */
        }

        .button-primary:hover {
            background-color: #4f46e5; /* Indigo 600 */
            transform: translateY(-2px);
        }

        .button-primary:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .answer-button {
            background-color: #e0e7ff; /* Indigo 100 */
            color: #4338ca; /* Indigo 700 */
            padding: 1rem; /* Increased padding for better tap target and readability */
            border-radius: 0.75rem; /* Rounded corners */
            font-size: 1.25rem; /* Increased font size for Hebrew words */
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            border: 2px solid #c7d2fe; /* Indigo 200 border */
            width: 100%;
            text-align: center;
            height: 65px; /* Fixed height for buttons to prevent layout shift */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .answer-button:hover:not(.correct):not(.incorrect):not(:disabled) {
            background-color: #c7d2fe; /* Indigo 200 */
            transform: translateY(-2px);
        }

        .answer-button.correct {
            background-color: #86efac; /* Green 300 */
            border-color: #22c55e; /* Green 500 */
            color: #16a34a; /* Green 700 */
        }

        .answer-button.incorrect {
            background-color: #fca5a5; /* Red 300 */
            border-color: #ef4444; /* Red 500 */
            color: #dc2626; /* Red 700 */
        }

        .answer-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .speaker-button {
            background: none;
            border: none;
            font-size: 2rem; /* Slightly smaller speaker icon */
            cursor: pointer;
            color: #4f46e5; /* Indigo 600 */
            transition: transform 0.2s ease;
            padding: 0;
            line-height: 1; /* Align icon better */
            display: flex; /* Use flex to center content if needed */
            align-items: center; /* Center vertically */
            justify-content: center; /* Center horizontally */
        }

        .speaker-button:hover {
            transform: scale(1.1);
        }

        .feedback-container { /* New container for fixed feedback position */
            min-height: 4rem; /* Fixed height to prevent layout shift */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 0.5rem; /* Adjusted margin - closer to buttons */
            transition: opacity 0.3s ease; /* Smooth transition for feedback message */
        }

        .feedback-message {
            font-size: 1.3rem; /* Slightly smaller font size */
            font-weight: bold;
            text-align: center;
        }

        .progress-text, .score-text {
            font-size: 1rem; /* Slightly smaller font size */
            color: #4b5563; /* Gray 600 */
        }

        .english-word {
            font-size: 2.5rem; /* Slightly smaller font for the English word */
            font-weight: bold;
            color: #1f2937; /* Gray 900 */
            margin-bottom: 0.8rem; /* Reduced margin - closer to buttons */
            direction: ltr; /* Ensure English word is LTR */
            flex-grow: 1; /* Allow word to take available space */
        }

        .word-and-speaker {
            display: flex;
            align-items: center; /* Vertically align word and speaker */
            justify-content: center; /* Center horizontally */
            gap: 0.5rem; /* Small gap between word and speaker */
            /* margin-bottom removed, managed by english-word margin-bottom */
        }

        .end-screen-message {
            font-size: 1.5rem; /* Slightly smaller font size */
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.8rem; /* Reduced margin */
        }

        .end-screen-score {
            font-size: 2rem; /* Slightly smaller font size */
            font-weight: bold;
            color: #4f46e5; /* Indigo 600 */
            margin-bottom: 1rem; /* Reduced margin */
        }

        /* Adjustments for smaller screens (e.g., phones) */
        @media (max-width: 640px) {
            .game-container {
                padding: 1rem;
                gap: 0.6rem; /* Even tighter overall gap for very small screens */
                min-height: 98vh; /* Even tighter fit for very small screens */
            }
            .button-primary {
                padding: 0.7rem 1.2rem;
                font-size: 1.05rem;
            }
            .answer-button {
                padding: 0.8rem;
                font-size: 1.15rem; /* Slightly larger for mobile */
                height: 60px; /* Fixed height for buttons on mobile */
            }
            .speaker-button {
                font-size: 1.8rem;
            }
            .english-word {
                font-size: 2.2rem;
                margin-bottom: 0.6rem; /* Tighter for mobile */
            }
            .feedback-container {
                min-height: 3.5rem; /* Adjusted for mobile */
                margin-top: 0.4rem; /* Tighter for mobile */
            }
            .feedback-message {
                font-size: 1.2rem;
            }
            .end-screen-message {
                font-size: 1.3rem;
            }
            .end-screen-score {
                font-size: 1.8rem;
            }
            .word-and-speaker {
                gap: 0.3rem;
            }
        }
    </style>
</head>
<body>
    <div id="game-container" class="game-container">
        <div id="start-screen" class="flex flex-col items-center justify-center gap-6 flex-grow">
            <h1 class="text-3xl font-bold text-gray-800">××©×—×§ ×”×˜×¨×™×•×•×™×” ×”×’×“×•×œ!</h1>
            <button id="start-button" class="button-primary">×‘×•××™ × ×ª×—×™×œ!</button>
        </div>

        <div id="game-screen" class="hidden flex-col items-center justify-between gap-4 flex-grow">
            <div class="w-full flex justify-between items-center mb-2">
                <div id="progress-display" class="progress-text"></div>
                <div id="score-display" class="score-text"></div>
            </div>

            <div class="word-and-speaker">
                <span id="english-word" class="english-word"></span>
                <button id="speaker-button" class="speaker-button">ğŸ”Š</button>
            </div>

            <div id="answer-buttons-container" class="grid grid-cols-2 gap-3 w-full">
                </div>

            <div id="feedback-container" class="feedback-container">
                <div id="feedback-message" class="feedback-message" style="opacity:0;"></div>
            </div>
        </div>

        <div id="end-screen" class="hidden flex-col items-center justify-center gap-6 flex-grow">
            <h2 class="end-screen-message">×¡×™×™×× ×• ××ª ×”××©×—×§!</h2>
            <div id="final-score" class="end-screen-score"></div>
            <p id="end-message" class="text-lg text-gray-700"></p>
            <button id="play-again-button" class="button-primary">×©×—×§ ×©×•×‘</button>
        </div>
    </div>

    <script>
        // Array of English words and their Hebrew translations - UPDATED
        const words = [
            { english: "Angry", hebrew: "×›×•×¢×¡" },
            { english: "Apple", hebrew: "×ª×¤×•×—" },
            { english: "Beach", hebrew: "×—×•×£ ×™×" },
            { english: "Be careful", hebrew: "×”×™×” ×–×”×™×¨" },
            { english: "Bike", hebrew: "××•×¤× ×™×™×" },
            { english: "Boat", hebrew: "×¡×™×¨×”" },
            { english: "Bread", hebrew: "×œ×—×" },
            { english: "Bus stop", hebrew: "×ª×—× ×ª ××•×˜×•×‘×•×¡" },
            { english: "But", hebrew: "××‘×œ" },
            { english: "Buy", hebrew: "×œ×§× ×•×ª" },
            { english: "Car", hebrew: "××›×•× ×™×ª" },
            { english: "Cheese", hebrew: "×’×‘×™× ×”" },
            { english: "Chicken", hebrew: "×¢×•×£" },
            { english: "Chocolate", hebrew: "×©×•×§×•×œ×“" },
            { english: "Clothes", hebrew: "×‘×’×“×™×" },
            { english: "Color", hebrew: "×¦×‘×¢" },
            { english: "Come in", hebrew: "×”×™×›× ×¡" },
            { english: "Cookie", hebrew: "×¢×•×’×™×™×”" },
            { english: "Cross the street", hebrew: "×œ×—×¦×•×ª ××ª ×”×›×‘×™×©" },
            { english: "Driver", hebrew: "× ×”×’" },
            { english: "Ears", hebrew: "××•×–× ×™×™×" },
            { english: "Favorite", hebrew: "××”×•×‘" },
            { english: "From", hebrew: "×-" },
            { english: "Fruit", hebrew: "×¤×¨×™" },
            { english: "Go down", hebrew: "×œ×¨×“×ª" },
            { english: "Go up", hebrew: "×œ×¢×œ×•×ª" },
            { english: "Helmet", hebrew: "×§×¡×“×”" },
            { english: "Juice", hebrew: "××™×¥" },
            { english: "Kitchen", hebrew: "××˜×‘×—" },
            { english: "Little", hebrew: "×§×˜×Ÿ" },
            { english: "Living room", hebrew: "×¡×œ×•×Ÿ" },
            { english: "Magic", hebrew: "×§×¡×" },
            { english: "Meat", hebrew: "×‘×©×¨" },
            { english: "Menu", hebrew: "×ª×¤×¨×™×˜" },
            { english: "Monkey", hebrew: "×§×•×£" },
            { english: "Now", hebrew: "×¢×›×©×™×•" },
            { english: "Pink", hebrew: "×•×¨×•×“" },
            { english: "Plane", hebrew: "××˜×•×¡" },
            { english: "Police", hebrew: "××©×˜×¨×”" },
            { english: "Potato", hebrew: "×ª×¤×•×— ××“××”" },
            { english: "Rain", hebrew: "×’×©×" },
            { english: "Slowly", hebrew: "×œ××˜" },
            { english: "Soup", hebrew: "××¨×§" },
            { english: "Station", hebrew: "×ª×—× ×”" },
            { english: "Tomato", hebrew: "×¢×’×‘× ×™×™×”" },
            { english: "Train", hebrew: "×¨×›×‘×ª" },
            { english: "Truck", hebrew: "××©××™×ª" },
            { english: "Wind", hebrew: "×¨×•×—" },
            { english: "Window", hebrew: "×—×œ×•×Ÿ" },
            { english: "Wolf", hebrew: "×–××‘" },
            { english: "Van", hebrew: "×•××Ÿ" },
            { english: "Very", hebrew: "×××•×“" },
            { english: "Wet", hebrew: "×¨×˜×•×‘" },
            // Added words based on your request
            { english: "Under", hebrew: "××ª×—×ª" },
            { english: "Behind", hebrew: "×××—×•×¨×™" },
            { english: "Next to", hebrew: "×œ×™×“" },
            { english: "In front of", hebrew: "×œ×¤× ×™" },
            { english: "House", hebrew: "×‘×™×ª" },
            { english: "Food", hebrew: "××•×›×œ" },
            { english: "Transport", hebrew: "×ª×—×‘×•×¨×”" }
        ];

        // --- Game State Variables ---
        let currentQuestions = []; // Array to hold the 10 questions for the current game
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestions = 10;

        // New variables for word repetition logic
        const recentWordsLimit = 30; // Do not repeat a word for this many questions
        let recentWordsHistory = []; // Stores the last X English words displayed
        const incorrectReviewLimit = 10; // Incorrect words can re-appear after this many questions
        let incorrectWordsForReview = []; // Stores words that were answered incorrectly

        // --- DOM Element References ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');

        const startButton = document.getElementById('start-button');
        const englishWordDisplay = document.getElementById('english-word');
        const speakerButton = document.getElementById('speaker-button');
        const answerButtonsContainer = document.getElementById('answer-buttons-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackMessage = document.getElementById('feedback-message');
        const progressDisplay = document.getElementById('progress-display');
        const scoreDisplay = document.getElementById('score-display');
        const finalScoreDisplay = document.getElementById('final-score');
        const endMessageDisplay = document.getElementById('end-message');
        const playAgainButton = document.getElementById('play-again-button');

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        speakerButton.addEventListener('click', speakWord);
        playAgainButton.addEventListener('click', startGame);

        // --- Helper Functions ---

        // Shuffles an array randomly (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Selects 10 unique random questions for the game, respecting repetition rules
        function selectRandomQuestions() {
            let questions = [];
            let availableWords = [...words]; // Create a mutable copy of all words
            
            // Filter out words that are too recent
            const filteredWords = availableWords.filter(word => 
                !recentWordsHistory.includes(word.english)
            );

            // Prioritize incorrect words for review if available and not too recent
            let reviewWords = incorrectWordsForReview.filter(word =>
                !recentWordsHistory.includes(word.english) && 
                word.lastShownIndex < currentQuestionIndex - incorrectReviewLimit
            );
            shuffleArray(reviewWords); // Shuffle review words for random priority

            // Try to pick from review words first
            while (questions.length < totalQuestions && reviewWords.length > 0) {
                const word = reviewWords.shift(); // Take from the start of reviewWords
                questions.push(word);
            }

            // Fill remaining questions from general filtered words
            let tempFilteredWords = shuffleArray([...filteredWords]); // Shuffle for randomness
            while (questions.length < totalQuestions && tempFilteredWords.length > 0) {
                const word = tempFilteredWords.shift();
                // Ensure we don't add duplicates from the reviewWords or existing questions
                if (!questions.some(q => q.english === word.english)) {
                    questions.push(word);
                }
            }

            // Fallback: If not enough unique words based on rules, pick from general words (least ideal but ensures game runs)
            if (questions.length < totalQuestions) {
                const backupWords = shuffleArray([...words]);
                while (questions.length < totalQuestions && backupWords.length > 0) {
                    const word = backupWords.shift();
                    if (!questions.some(q => q.english === word.english)) {
                        questions.push(word);
                    }
                }
            }

            return questions;
        }

        // Generates 3 incorrect Hebrew answers for a given correct answer, trying to avoid recent incorrect options
        function generateIncorrectAnswers(correctHebrew) {
            const incorrectOptions = [];
            const allHebrewWords = words.map(w => w.hebrew).filter(h => h !== correctHebrew);
            
            // Prioritize incorrect options that haven't been shown recently as options
            // This is a more complex heuristic, simple randomness often works well for options
            // Let's ensure variety by picking from a shuffled list and ensuring uniqueness
            
            const shuffledAllHebrew = shuffleArray(allHebrewWords);
            for (let i = 0; i < 3 && i < shuffledAllHebrew.length; i++) {
                incorrectOptions.push(shuffledAllHebrew[i]);
            }
            return incorrectOptions;
        }

        // --- Game Flow Functions ---

        // Starts a new game
        function startGame() {
            recentWordsHistory = []; // Clear history for a new game
            incorrectWordsForReview = []; // Clear incorrect words for a new game
            currentQuestions = selectRandomQuestions(); // Now intelligently selects questions
            currentQuestionIndex = 0;
            score = 0;

            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex');

            displayQuestion();
        }

        // Displays the current question
        function displayQuestion() {
            // Clear feedback message and hide it
            feedbackMessage.textContent = '';
            feedbackMessage.style.opacity = '0'; // Hide with opacity for smooth transition
            answerButtonsContainer.innerHTML = ''; // Clear previous buttons

            progressDisplay.textContent = `×©××œ×” ${currentQuestionIndex + 1} ××ª×•×š ${totalQuestions}`;
            scoreDisplay.textContent = `× ×™×§×•×“: ${score}`;

            const currentQuestion = currentQuestions[currentQuestionIndex];
            englishWordDisplay.textContent = currentQuestion.english;

            // Add current word to history and manage its size
            recentWordsHistory.push(currentQuestion.english);
            if (recentWordsHistory.length > recentWordsLimit) {
                recentWordsHistory.shift(); // Remove oldest word if limit exceeded
            }
            
            // Update lastShownIndex for the current word if it's in incorrectReview
            const reviewWordIndex = incorrectWordsForReview.findIndex(w => w.english === currentQuestion.english);
            if (reviewWordIndex !== -1) {
                incorrectWordsForReview[reviewWordIndex].lastShownIndex = currentQuestionIndex;
            }


            speakWord();

            const correctHebrew = currentQuestion.hebrew;
            const incorrectHebrewOptions = generateIncorrectAnswers(correctHebrew);
            const allOptions = shuffleArray([correctHebrew, ...incorrectHebrewOptions]);

            allOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('answer-button');
                button.dataset.answer = option;
                button.addEventListener('click', handleAnswer);
                answerButtonsContainer.appendChild(button);
            });

            speakerButton.disabled = false;
        }

        // Handles user's answer selection
        function handleAnswer(event) {
            const selectedButton = event.target;
            const selectedAnswer = selectedButton.dataset.answer;
            const currentQuestion = currentQuestions[currentQuestionIndex];
            const correctHebrew = currentQuestion.hebrew;
            let delayTime = 0;

            // Disable all answer buttons
            Array.from(answerButtonsContainer.children).forEach(button => {
                button.disabled = true;
            });
            speakerButton.disabled = true;

            if (selectedAnswer === correctHebrew) {
                score++;
                feedbackMessage.textContent = '× ×›×•×Ÿ! ğŸ‘';
                selectedButton.classList.add('correct');
                delayTime = 1500; // 1.5 seconds for correct answer
                // Remove from incorrectReview if correctly answered now
                incorrectWordsForReview = incorrectWordsForReview.filter(w => w.english !== currentQuestion.english);
            } else {
                feedbackMessage.textContent = `×œ× ×‘×“×™×•×§... ×”×ª×©×•×‘×” ×”× ×›×•× ×” ×”×™×: ${correctHebrew}`;
                selectedButton.classList.add('incorrect');
                // Highlight the correct answer
                Array.from(answerButtonsContainer.children).forEach(button => {
                    if (button.dataset.answer === correctHebrew) {
                        button.classList.add('correct');
                    }
                });
                delayTime = 3000; // 3 seconds for incorrect answer

                // Add to incorrectReview if not already there, or update last incorrect attempt
                const existingIncorrect = incorrectWordsForReview.find(w => w.english === currentQuestion.english);
                if (!existingIncorrect) {
                    incorrectWordsForReview.push({ english: currentQuestion.english, hebrew: currentQuestion.hebrew, lastShownIndex: currentQuestionIndex });
                } else {
                    existingIncorrect.lastShownIndex = currentQuestionIndex; // Update timestamp
                }
            }

            scoreDisplay.textContent = `× ×™×§×•×“: ${score}`;
            feedbackMessage.style.opacity = '1'; // Show feedback message

            setTimeout(nextQuestion, delayTime);
        }

        // Moves to the next question or ends the game
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < totalQuestions) {
                displayQuestion();
            } else {
                endGame();
            }
        }

        // Ends the game and displays summary with tailored and humorous feedback
        function endGame() {
            gameScreen.classList.add('hidden');
            gameScreen.classList.remove('flex');
            endScreen.classList.remove('hidden');
            endScreen.classList.add('flex');

            finalScoreDisplay.textContent = `×¦×‘×¨×ª ${score} ××ª×•×š ${totalQuestions} × ×§×•×“×•×ª!`;

            let message = '';
            if (score === totalQuestions) {
                message = '×•×•××•! ××ª ×¤×©×•×˜ ××œ×•×¤×”! ×”××™×œ×™× ×¨×•×§×“×•×ª ×‘×©×‘×™×œ×š! ğŸ’ƒ ××™×–×” ×›×™×©×¨×•×Ÿ ××“×”×™×!';
            } else if (score >= 8) { // 8-9 correct
                message = '× ×”×“×¨! ××ª ××‘×™× ×” ××™×œ×™× ×›××• ×§×•×¡××ª! âœ¨ ×”××©×™×›×™ ×œ×ª×¨×’×œ ×•××£ ××™×œ×” ×œ× ×ª×‘×¨×— ×œ×š!';
            } else if (score >= 5) { // 5-7 correct
                message = '×™×¤×” ×××•×“! ××ª ×‘×“×¨×š ×”× ×›×•× ×”! ×ª×¨×’×•×œ × ×•×¡×£ ×™×”×¤×•×š ××•×ª×š ×œ×›×•×›×‘×ª ××™×œ×™× ×××™×ª×™×ª! ğŸŒŸ ××œ×•×¤×”!';
            } else { // 0-4 correct
                message = '× ×™×¡×™×ª ×™×¤×” ×××•×“! ×›×œ ×”×ª×—×œ×” ×§×©×”, ××‘×œ ××ª ×—×–×§×” ×•×× ×—× ×• × ×œ××“ ×‘×™×—×“! ×‘×•××™ × × ×¡×” ×©×•×‘ ×•× ×¨××” ×œ××™×œ×™× ××™ ×”×‘×•×¡! ğŸ’ª';
            }
            endMessageDisplay.textContent = message;
        }

        // Speaks the English word using Web Speech API
        function speakWord() {
            const wordToSpeak = englishWordDisplay.textContent;
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(wordToSpeak);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            } else {
                console.warn("Speech Synthesis API not supported in this browser.");
                if (feedbackMessage.style.opacity === '0') {
                    feedbackMessage.textContent = "×”××›×©×™×¨ ×©×œ×š ×œ× ×ª×•××š ×‘×”×§×¨××ª ××™×œ×™×.";
                    feedbackMessage.style.opacity = '1';
                    setTimeout(() => {
                        feedbackMessage.style.opacity = '0';
                    }, 3000);
                }
            }
        }

        // Initialize the game on window load by showing the start screen
        window.onload = function() {
            startScreen.classList.remove('hidden');
            startScreen.classList.add('flex');
            gameScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
        };

    </script>
</body>
</html>
