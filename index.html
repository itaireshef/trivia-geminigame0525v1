<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>משחק הטריוויה הגדול!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the game */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* Light blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0.5rem;
            box-sizing: border-box;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .game-container {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            width: 100%;
            max-width: 500px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.8rem; /* Default gap */
            min-height: 95vh;
            justify-content: space-between;
        }

        /* Specific styles for the start screen container (only applies to start screen) */
        #start-screen.game-container {
            /* Vibrant gradient for start screen */
            background: linear-gradient(135deg, #a78bfa 0%, #818cf8 100%); /* Purple-blue gradient */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        /* Ensure general game screen has white background */
        #game-screen.game-container {
             background-color: #ffffff;
        }


        /* Responsive adjustments for mobile (critical for spacing) */
        @media (max-width: 640px) {
            .game-container {
                padding: 0.8rem; /* Even smaller padding on small screens */
                gap: 0.4rem; /* Tighter general gap for mobile - VERY IMPORTANT */
                min-height: 98vh; /* Ensure it fits almost full height */
            }
            /* Specific overrides to tighten spacing as per user request */
            .english-word {
                margin-bottom: 0.1rem !important; /* EXTREMELY tight margin for word on mobile */
                font-size: 2.2rem !important; /* Slightly smaller font for English word on mobile */
            }
            .answer-buttons-container {
                gap: 0.2rem !important; /* VERY tight gap between buttons */
                margin-top: 0.1rem !important; /* Tiny gap between word and buttons - VERY IMPORTANT */
            }
            .answer-button {
                height: 58px !important; /* Slightly reduce button height for tighter fit */
                font-size: 1.15rem !important; /* Adjust Hebrew text size for tightness */
            }
            .feedback-container {
                margin-top: 0.2rem !important; /* VERY tight margin for feedback, matches above */
                min-height: 2.8rem !important; /* Smaller feedback container height */
            }
            .feedback-message {
                font-size: 1.1rem !important; /* Smaller font for feedback */
            }
            .speaker-button {
                font-size: 1.5rem !important; /* Smaller speaker icon for mobile */
            }
            .word-and-speaker {
                gap: 0.1rem !important; /* Minimal gap between word and speaker */
            }
            /* Start screen mobile specific overrides */
            #start-screen h1 {
                font-size: 2.8rem !important; /* Larger font for start screen title */
                margin-bottom: 0.8rem !important; /* More space below title */
            }
            #start-screen h1 .emoji {
                font-size: 2.5rem !important; /* Adjust emoji size for mobile */
            }
            #start-button {
                font-size: 1.6rem !important; /* Larger button text for start screen */
                padding: 1rem 2rem !important; /* Larger padding for start button */
            }
        }


        .button-primary {
            background-color: #6366f1; /* Indigo 500 */
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: none;
            width: 100%;
        }

        .button-primary:hover {
            background-color: #4f46e5; /* Indigo 600 */
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }

        .button-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        /* Animation for start button */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        #start-button {
            animation: pulse 1.7s infinite ease-in-out;
        }

        .answer-button {
            background-color: #e0e7ff; /* Indigo 100 */
            color: #4338ca; /* Indigo 700 */
            padding: 1rem;
            border-radius: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease;
            border: 2px solid #c7d2fe; /* Indigo 200 border */
            width: 100%;
            text-align: center;
            height: 65px; /* Fixed height for buttons to prevent layout shift */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .answer-button:hover:not(.correct):not(.incorrect):not(:disabled) {
            background-color: #c7d2fe; /* Indigo 200 */
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .answer-button.correct {
            background-color: #86efac; /* Green 300 */
            border-color: #22c55e; /* Green 500 */
            color: #16a34a; /* Green 700 */
        }

        .answer-button.incorrect {
            background-color: #fca5a5; /* Red 300 */
            border-color: #ef4444; /* Red 500 */
            color: #dc2626; /* Red 700 */
        }

        .answer-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .speaker-button {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #4f46e5; /* Indigo 600 */
            transition: transform 0.2s ease;
            padding: 0;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .speaker-button:hover {
            transform: scale(1.1);
        }

        .feedback-container {
            min-height: 4rem; /* Fixed height to prevent layout shift */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 0.5rem; /* Standard margin-top for feedback */
            transition: opacity 0.3s ease;
        }

        .feedback-message {
            font-size: 1.3rem;
            font-weight: bold;
            text-align: center;
            color: #1f2937; /* Default dark color */
        }
        .feedback-message.correct-feedback {
            color: #16a34a; /* Green 700 */
        }
        .feedback-message.incorrect-feedback {
            color: #dc2626; /* Red 700 */
        }


        .progress-text, .score-text {
            font-size: 1rem;
            color: #4b5563; /* Gray 600 */
        }

        .english-word {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1f2937; /* Gray 900 */
            margin-bottom: 0.8rem;
            direction: ltr; /* Ensure English word is LTR */
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-and-speaker {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .end-screen-message {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.8rem;
        }

        .end-screen-score {
            font-size: 2rem;
            font-weight: bold;
            color: #4f46e5; /* Indigo 600 */
            margin-bottom: 1rem;
        }

        /* Start screen specific styles */
        #start-screen h1 {
            font-size: 3.5rem;
            font-weight: bold;
            color: #ffffff; /* White text for gradient background */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); /* Text shadow for pop */
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
        }
        #start-screen h1 .emoji {
            font-size: 3.2rem;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }
        #start-screen button {
            padding: 1.2rem 2.5rem;
            font-size: 1.8rem;
            border-radius: 1.2rem;
            background-color: #ffffff; /* White button on gradient background */
            color: #6366f1; /* Indigo 500 text for white button */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25); /* More prominent shadow for start button */
        }
        #start-screen button:hover {
            background-color: #f3f4f6; /* Light gray on hover */
            color: #4f46e5; /* Darker indigo on hover */
            transform: translateY(-4px); /* Even more pronounced hover */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        #start-screen button:active {
            transform: translateY(0);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }


    </style>
</head>
<body>
    <div id="game-container" class="game-container">
        <div id="start-screen" class="game-container flex flex-col items-center justify-center gap-6 flex-grow">
            <h1>משחק הטריוויה הגדול! <span class="emoji">🎉</span></h1>
            <button id="start-button" class="button-primary">בואי נתחיל!</button>
        </div>

        <div id="game-screen" class="hidden flex-col items-center justify-between gap-4 flex-grow">
            <div class="w-full flex justify-between items-center mb-2">
                <div id="progress-display" class="progress-text"></div>
                <div id="score-display" class="score-text"></div>
            </div>

            <div class="word-and-speaker">
                <span id="english-word" class="english-word"></span>
                <button id="speaker-button" class="speaker-button">🔊</button>
            </div>

            <div id="answer-buttons-container" class="grid grid-cols-2 gap-3 w-full">
                </div>

            <div id="feedback-container" class="feedback-container">
                <div id="feedback-message" class="feedback-message" style="opacity:0;"></div>
            </div>
        </div>

        <div id="end-screen" class="hidden flex-col items-center justify-center gap-6 flex-grow">
            <h2 class="end-screen-message">סיימנו את המשחק!</h2>
            <div id="final-score" class="end-screen-score"></div>
            <p id="end-message" class="text-lg text-gray-700"></p>
            <button id="play-again-button" class="button-primary">שחק שוב</button>
        </div>
    </div>

    <script>
        // Array of English words and their Hebrew translations
        const words = [
            { english: "Angry", hebrew: "כועס" },
            { english: "Apple", hebrew: "תפוח" },
            { english: "Beach", hebrew: "חוף ים" },
            { english: "Be careful", hebrew: "היה זהיר" },
            { english: "Bike", hebrew: "אופניים" },
            { english: "Boat", hebrew: "סירה" },
            { english: "Bread", hebrew: "לחם" },
            { english: "Bus stop", hebrew: "תחנת אוטובוס" },
            { english: "But", hebrew: "אבל" },
            { english: "Buy", hebrew: "לקנות" },
            { english: "Car", hebrew: "מכונית" },
            { english: "Cheese", hebrew: "גבינה" },
            { english: "Chicken", hebrew: "עוף" },
            { english: "Chocolate", hebrew: "שוקולד" },
            { english: "Clothes", hebrew: "בגדים" },
            { english: "Color", hebrew: "צבע" },
            { english: "Come in", hebrew: "היכנס" },
            { english: "Cookie", hebrew: "עוגייה" },
            { english: "Cross the street", hebrew: "לחצות את הכביש" },
            { english: "Driver", hebrew: "נהג" },
            { english: "Ears", hebrew: "אוזניים" },
            { english: "Favorite", hebrew: "אהוב" },
            { english: "From", hebrew: "מ-" },
            { english: "Fruit", hebrew: "פרי" },
            { english: "Go down", hebrew: "לרדת" },
            { english: "Go up", hebrew: "לעלות" },
            { english: "Helmet", hebrew: "קסדה" },
            { english: "Juice", hebrew: "מיץ" },
            { english: "Kitchen", hebrew: "מטבח" },
            { english: "Little", hebrew: "קטן" },
            { english: "Living room", hebrew: "סלון" },
            { english: "Magic", hebrew: "קסם" },
            { english: "Meat", hebrew: "בשר" },
            { english: "Menu", hebrew: "תפריט" },
            { english: "Monkey", hebrew: "קוף" },
            { english: "Now", hebrew: "עכשיו" },
            { english: "Pink", hebrew: "ורוד" },
            { english: "Plane", hebrew: "מטוס" },
            { english: "Police", hebrew: "משטרה" },
            { english: "Potato", hebrew: "תפוח אדמה" },
            { english: "Rain", hebrew: "גשם" },
            { english: "Slowly", hebrew: "לאט" },
            { english: "Soup", hebrew: "מרק" },
            { english: "Station", hebrew: "תחנה" },
            { english: "Tomato", hebrew: "עגבנייה" },
            { english: "Train", hebrew: "רכבת" },
            { english: "Truck", hebrew: "משאית" },
            { english: "Wind", hebrew: "רוח" },
            { english: "Window", hebrew: "חלון" },
            { english: "Wolf", hebrew: "זאב" },
            { english: "Van", hebrew: "ואן" },
            { english: "Very", hebrew: "מאוד" },
            { english: "Wet", hebrew: "רטוב" },
            { english: "Under", hebrew: "מתחת" },
            { english: "Behind", hebrew: "מאחורי" },
            { english: "Next to", hebrew: "ליד" },
            { english: "In front of", hebrew: "לפני" },
            { english: "House", hebrew: "בית" },
            { english: "Food", hebrew: "אוכל" },
            { english: "Transport", hebrew: "תחבורה" }
        ];

        // --- Game State Variables ---
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestions = 10;

        // Word repetition logic
        const recentWordsLimit = 30; // Do not repeat a word for this many questions in overall game history
        let recentWordsHistory = []; // Stores the last X English words displayed (English word string)
        const incorrectReviewCooldown = 10; // Incorrect words can re-appear after this many questions
        let incorrectWordsForReview = []; // Stores words that were answered incorrectly (full word object)

        // --- DOM Element References ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');

        const startButton = document.getElementById('start-button');
        const englishWordDisplay = document.getElementById('english-word');
        const speakerButton = document.getElementById('speaker-button');
        const answerButtonsContainer = document.getElementById('answer-buttons-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackMessage = document.getElementById('feedback-message');
        const progressDisplay = document.getElementById('progress-display');
        const scoreDisplay = document.getElementById('score-display');
        const finalScoreDisplay = document.getElementById('final-score');
        const endMessageDisplay = document.getElementById('end-message');
        const playAgainButton = document.getElementById('play-again-button');

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        speakerButton.addEventListener('click', speakWord);
        playAgainButton.addEventListener('click', startGame);

        // --- Helper Functions ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function selectRandomQuestions() {
            let selectedForThisGame = [];
            let allAvailableWords = [...words];

            let eligibleIncorrectWords = incorrectWordsForReview.filter(wordObj => 
                currentQuestionIndex - wordObj.lastShownIndex >= incorrectReviewCooldown && 
                !recentWordsHistory.includes(wordObj.english) 
            );
            shuffleArray(eligibleIncorrectWords);

            while (selectedForThisGame.length < totalQuestions && eligibleIncorrectWords.length > 0) {
                const word = eligibleIncorrectWords.shift();
                selectedForThisGame.push(word);
            }

            let generalPool = allAvailableWords.filter(wordObj => 
                !recentWordsHistory.includes(wordObj.english) && 
                !selectedForThisGame.some(q => q.english === wordObj.english)
            );
            shuffleArray(generalPool);

            while (selectedForThisGame.length < totalQuestions && generalPool.length > 0) {
                const word = generalPool.shift();
                if (!selectedForThisGame.some(q => q.english === word.english)) {
                    selectedForThisGame.push(word);
                }
            }

            if (selectedForThisGame.length < totalQuestions) {
                let backupPool = allAvailableWords.filter(wordObj => 
                    !selectedForThisGame.some(q => q.english === wordObj.english)
                );
                shuffleArray(backupPool);
                while (selectedForThisGame.length < totalQuestions && backupPool.length > 0) {
                    const word = backupPool.shift();
                    if (!selectedForThisGame.some(q => q.english === word.english)) {
                        selectedForThisGame.push(word);
                    }
                }
            }
            
            return selectedForThisGame;
        }

        function generateIncorrectAnswers(correctHebrew) {
            const incorrectOptions = [];
            const allOtherHebrewWords = words.map(w => w.hebrew).filter(h => h !== correctHebrew);
            let tempUsedOptions = new Set([correctHebrew]); 

            const shuffledOthers = shuffleArray(allOtherHebrewWords);

            for (let i = 0; i < shuffledOthers.length && incorrectOptions.length < 3; i++) {
                const candidate = shuffledOthers[i];
                if (!tempUsedOptions.has(candidate)) {
                    incorrectOptions.push(candidate);
                    tempUsedOptions.add(candidate);
                }
            }
            
            while (incorrectOptions.length < 3 && allOtherHebrewWords.length > incorrectOptions.length) {
                const randomIndex = Math.floor(Math.random() * allOtherHebrewWords.length);
                const candidate = allOtherHebrewWords[randomIndex];
                if (!tempUsedOptions.has(candidate)) {
                    incorrectOptions.push(candidate);
                    tempUsedOptions.add(candidate);
                }
            }

            return incorrectOptions;
        }

        // --- Game Flow Functions ---

        function startGame() {
            recentWordsHistory = []; 
            currentQuestionIndex = 0;
            score = 0;

            currentQuestions = selectRandomQuestions();

            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex');

            displayQuestion();
        }

        function displayQuestion() {
            feedbackMessage.textContent = '';
            feedbackMessage.style.opacity = '0';
            feedbackMessage.classList.remove('correct-feedback', 'incorrect-feedback');
            answerButtonsContainer.innerHTML = '';

            progressDisplay.textContent = `שאלה ${currentQuestionIndex + 1} מתוך ${totalQuestions}`;
            scoreDisplay.textContent = `ניקוד: ${score}`;

            const currentQuestion = currentQuestions[currentQuestionIndex];
            englishWordDisplay.textContent = currentQuestion.english;

            recentWordsHistory.push(currentQuestion.english);
            if (recentWordsHistory.length > recentWordsLimit) {
                recentWordsHistory.shift();
            }
            
            const reviewWordEntry = incorrectWordsForReview.find(w => w.english === currentQuestion.english);
            if (reviewWordEntry) {
                reviewWordEntry.lastShownIndex = currentQuestionIndex;
            }

            speakWord();

            const correctHebrew = currentQuestion.hebrew;
            const incorrectHebrewOptions = generateIncorrectAnswers(correctHebrew);
            const allOptions = shuffleArray([correctHebrew, ...incorrectHebrewOptions]);

            allOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('answer-button');
                button.dataset.answer = option;
                button.addEventListener('click', handleAnswer);
                answerButtonsContainer.appendChild(button);
            });

            speakerButton.disabled = false;
        }

        function handleAnswer(event) {
            const selectedButton = event.target;
            const selectedAnswer = selectedButton.dataset.answer;
            const currentQuestion = currentQuestions[currentQuestionIndex];
            const correctHebrew = currentQuestion.hebrew;
            let delayTime = 0;

            Array.from(answerButtonsContainer.children).forEach(button => {
                button.disabled = true;
            });
            speakerButton.disabled = true;

            if (selectedAnswer === correctHebrew) {
                score++;
                feedbackMessage.textContent = 'נכון! 👏';
                feedbackMessage.classList.add('correct-feedback');
                selectedButton.classList.add('correct');
                delayTime = 1500;
                incorrectWordsForReview = incorrectWordsForReview.filter(w => w.english !== currentQuestion.english);
            } else {
                feedbackMessage.textContent = `לא בדיוק... התשובה הנכונה היא: ${correctHebrew}`;
                feedbackMessage.classList.add('incorrect-feedback');
                selectedButton.classList.add('incorrect');
                Array.from(answerButtonsContainer.children).forEach(button => {
                    if (button.dataset.answer === correctHebrew) {
                        button.classList.add('correct');
                    }
                });
                delayTime = 3000;

                const existingIncorrect = incorrectWordsForReview.find(w => w.english === currentQuestion.english);
                if (!existingIncorrect) {
                    incorrectWordsForReview.push({ english: currentQuestion.english, hebrew: currentQuestion.hebrew, lastShownIndex: currentQuestionIndex });
                } else {
                    existingIncorrect.lastShownIndex = currentQuestionIndex;
                }
            }

            scoreDisplay.textContent = `ניקוד: ${score}`;
            feedbackMessage.style.opacity = '1';

            setTimeout(nextQuestion, delayTime);
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < totalQuestions) {
                displayQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            gameScreen.classList.add('hidden');
            gameScreen.classList.remove('flex');
            endScreen.classList.remove('hidden');
            endScreen.classList.add('flex');

            finalScoreDisplay.textContent = `צברת ${score} מתוך ${totalQuestions} נקודות!`;

            let message = '';
            if (score === totalQuestions) {
                message = 'וואו! את פשוט אלופה! המילים רוקדות בשבילך! 💃 איזה כישרון מדהים!';
            } else if (score >= 8) {
                message = 'נהדר! את מבינה מילים כמו קוסמת! ✨ המשיכי לתרגל ואף מילה לא תברח לך!';
            } else if (score >= 5) {
                message = 'יפה מאוד! את בדרך הנכונה! תרגול נוסף יהפוך אותך לכוכבת מילים אמיתית! 🌟 אלופה!';
            } else {
                message = 'ניסית יפה מאוד! כל התחלה קשה, אבל את חזקה ואנחנו נלמד ביחד! בואי ננסה שוב ונראה למילים מי הבוס! 💪';
            }
            endMessageDisplay.textContent = message;
        }

        function speakWord() {
            const wordToSpeak = englishWordDisplay.textContent;
            if ('speechSynthesis' in window && wordToSpeak) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(wordToSpeak);
                utterance.lang = 'en-US';
                utterance.volume = 1;
                utterance.rate = 1;
                utterance.pitch = 1;
                window.speechSynthesis.speak(utterance);
            } else {
                console.warn("Speech Synthesis API not supported or no word to speak.");
                if (feedbackMessage.style.opacity === '0' || feedbackMessage.classList.contains('incorrect-feedback')) {
                    feedbackMessage.textContent = "המכשיר שלך לא תומך בהקראת מילים או שיש בעיה.";
                    feedbackMessage.classList.add('incorrect-feedback');
                    feedbackMessage.style.opacity = '1';
                    setTimeout(() => {
                        feedbackMessage.style.opacity = '0';
                        feedbackMessage.classList.remove('incorrect-feedback');
                    }, 3000);
                }
            }
        }

        window.onload = function() {
            startScreen.classList.remove('hidden');
            startScreen.classList.add('flex');
            gameScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
        };

    </script>
</body>
</html>
