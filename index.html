<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>משחק הטריוויה הגדול!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the game */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as per instructions */
            background-color: #f0f9ff; /* Light blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Full viewport height */
            margin: 0;
            padding: 0.5rem; /* Reduced padding for mobile */
            box-sizing: border-box;
            overflow: hidden; /* Prevent scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling for iOS */
        }

        .game-container {
            background-color: #ffffff;
            border-radius: 1.5rem; /* Rounded corners */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 1.5rem; /* Reduced padding for mobile */
            width: 100%;
            max-width: 500px; /* Max width for better readability on large screens */
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.8rem; /* Default gap */
            min-height: 95vh; /* Ensure it takes up most of the viewport height */
            justify-content: space-between; /* Distribute space vertically */
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 640px) {
            .game-container {
                padding: 0.8rem; /* Even smaller padding on small screens */
                gap: 0.5rem; /* Tighter gap for mobile */
                min-height: 98vh; /* Ensure it fits almost full height */
            }
            .english-word {
                margin-bottom: 0.4rem !important; /* Extremely tight margin for word on mobile */
            }
            .answer-buttons-container {
                gap: 0.2rem !important; /* Very tight gap for buttons */
            }
            .feedback-container {
                margin-top: 0.2rem !important; /* Very tight margin for feedback */
                min-height: 3rem !important; /* Smaller feedback container height */
            }
            .feedback-message {
                font-size: 1.1rem !important; /* Smaller font for feedback */
            }
            .speaker-button {
                font-size: 1.6rem !important; /* Smaller speaker icon for mobile */
            }
            .word-and-speaker {
                gap: 0.2rem !important; /* Smaller gap between word and speaker */
            }
            #start-screen h1 {
                font-size: 2.5rem !important; /* Larger font for start screen title */
            }
            #start-button {
                font-size: 1.5rem !important; /* Larger button text for start screen */
                padding: 1rem 2rem !important; /* Larger padding for start button */
            }
        }


        .button-primary {
            background-color: #6366f1; /* Indigo 500 */
            color: white;
            padding: 0.8rem 1.5rem; /* Standard padding */
            border-radius: 0.75rem; /* Rounded corners */
            font-size: 1.1rem; /* Standard font size */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            width: 100%; /* Full width */
        }

        .button-primary:hover {
            background-color: #4f46e5; /* Indigo 600 */
            transform: translateY(-2px);
        }

        .button-primary:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* Animation for start button */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        #start-button {
            animation: pulse 1.5s infinite;
        }

        .answer-button {
            background-color: #e0e7ff; /* Indigo 100 */
            color: #4338ca; /* Indigo 700 */
            padding: 1rem; /* Increased padding for better tap target and readability */
            border-radius: 0.75rem; /* Rounded corners */
            font-size: 1.25rem; /* Increased font size for Hebrew words */
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            border: 2px solid #c7d2fe; /* Indigo 200 border */
            width: 100%;
            text-align: center;
            height: 65px; /* Fixed height for buttons to prevent layout shift */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .answer-button:hover:not(.correct):not(.incorrect):not(:disabled) {
            background-color: #c7d2fe; /* Indigo 200 */
            transform: translateY(-2px);
        }

        .answer-button.correct {
            background-color: #86efac; /* Green 300 */
            border-color: #22c55e; /* Green 500 */
            color: #16a34a; /* Green 700 */
        }

        .answer-button.incorrect {
            background-color: #fca5a5; /* Red 300 */
            border-color: #ef4444; /* Red 500 */
            color: #dc2626; /* Red 700 */
        }

        .answer-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .speaker-button {
            background: none;
            border: none;
            font-size: 2rem; /* Slightly smaller speaker icon */
            cursor: pointer;
            color: #4f46e5; /* Indigo 600 */
            transition: transform 0.2s ease;
            padding: 0;
            line-height: 1; /* Align icon better */
            display: flex; /* Use flex to center content if needed */
            align-items: center; /* Center vertically */
            justify-content: center; /* Center horizontally */
        }

        .speaker-button:hover {
            transform: scale(1.1);
        }

        .feedback-container { /* New container for fixed feedback position */
            min-height: 4rem; /* Fixed height to prevent layout shift */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-top: 0.5rem; /* Adjusted margin - closer to buttons */
            transition: opacity 0.3s ease; /* Smooth transition for feedback message */
        }

        .feedback-message {
            font-size: 1.3rem; /* Slightly smaller font size */
            font-weight: bold;
            text-align: center;
            /* Added specific colors for feedback */
            color: #1f2937; /* Default dark color */
        }
        .feedback-message.correct-feedback {
            color: #16a34a; /* Green 700 */
        }
        .feedback-message.incorrect-feedback {
            color: #dc2626; /* Red 700 */
        }


        .progress-text, .score-text {
            font-size: 1rem; /* Slightly smaller font size */
            color: #4b5563; /* Gray 600 */
        }

        .english-word {
            font-size: 2.5rem; /* Slightly smaller font for the English word */
            font-weight: bold;
            color: #1f2937; /* Gray 900 */
            margin-bottom: 0.8rem; /* Reduced margin - closer to buttons */
            direction: ltr; /* Ensure English word is LTR */
            flex-grow: 1; /* Allow word to take available space */
            display: flex; /* Added flex to center content if needed */
            align-items: center; /* Center vertically */
            justify-content: center; /* Center horizontally */
        }

        .word-and-speaker {
            display: flex;
            align-items: center; /* Vertically align word and speaker */
            justify-content: center; /* Center horizontally */
            gap: 0.5rem; /* Small gap between word and speaker */
        }

        .end-screen-message {
            font-size: 1.5rem; /* Slightly smaller font size */
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.8rem; /* Reduced margin */
        }

        .end-screen-score {
            font-size: 2rem; /* Slightly smaller font size */
            font-weight: bold;
            color: #4f46e5; /* Indigo 600 */
            margin-bottom: 1rem; /* Reduced margin */
        }

        /* Start screen specific styles */
        #start-screen h1 {
            font-size: 3rem; /* Very large font for the title */
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #start-screen button {
            padding: 1.2rem 2.5rem; /* Larger padding for the button */
            font-size: 1.3rem; /* Larger font size for the button */
            border-radius: 1rem; /* More rounded corners */
        }

    </style>
</head>
<body>
    <div id="game-container" class="game-container">
        <div id="start-screen" class="flex flex-col items-center justify-center gap-6 flex-grow">
            <h1>משחק הטריוויה הגדול! 🎉</h1>
            <button id="start-button" class="button-primary">בואי נתחיל!</button>
        </div>

        <div id="game-screen" class="hidden flex-col items-center justify-between gap-4 flex-grow">
            <div class="w-full flex justify-between items-center mb-2">
                <div id="progress-display" class="progress-text"></div>
                <div id="score-display" class="score-text"></div>
            </div>

            <div class="word-and-speaker">
                <span id="english-word" class="english-word"></span>
                <button id="speaker-button" class="speaker-button">🔊</button>
            </div>

            <div id="answer-buttons-container" class="grid grid-cols-2 gap-3 w-full">
                </div>

            <div id="feedback-container" class="feedback-container">
                <div id="feedback-message" class="feedback-message" style="opacity:0;"></div>
            </div>
        </div>

        <div id="end-screen" class="hidden flex-col items-center justify-center gap-6 flex-grow">
            <h2 class="end-screen-message">סיימנו את המשחק!</h2>
            <div id="final-score" class="end-screen-score"></div>
            <p id="end-message" class="text-lg text-gray-700"></p>
            <button id="play-again-button" class="button-primary">שחק שוב</button>
        </div>
    </div>

    <script>
        // Array of English words and their Hebrew translations - UPDATED
        const words = [
            { english: "Angry", hebrew: "כועס" },
            { english: "Apple", hebrew: "תפוח" },
            { english: "Beach", hebrew: "חוף ים" },
            { english: "Be careful", hebrew: "היה זהיר" },
            { english: "Bike", hebrew: "אופניים" },
            { english: "Boat", hebrew: "סירה" },
            { english: "Bread", hebrew: "לחם" },
            { english: "Bus stop", hebrew: "תחנת אוטובוס" },
            { english: "But", hebrew: "אבל" },
            { english: "Buy", hebrew: "לקנות" },
            { english: "Car", hebrew: "מכונית" },
            { english: "Cheese", hebrew: "גבינה" },
            { english: "Chicken", hebrew: "עוף" },
            { english: "Chocolate", hebrew: "שוקולד" },
            { english: "Clothes", hebrew: "בגדים" },
            { english: "Color", hebrew: "צבע" },
            { english: "Come in", hebrew: "היכנס" },
            { english: "Cookie", hebrew: "עוגייה" },
            { english: "Cross the street", hebrew: "לחצות את הכביש" },
            { english: "Driver", hebrew: "נהג" },
            { english: "Ears", hebrew: "אוזניים" },
            { english: "Favorite", hebrew: "אהוב" },
            { english: "From", hebrew: "מ-" },
            { english: "Fruit", hebrew: "פרי" },
            { english: "Go down", hebrew: "לרדת" },
            { english: "Go up", hebrew: "לעלות" },
            { english: "Helmet", hebrew: "קסדה" },
            { english: "Juice", hebrew: "מיץ" },
            { english: "Kitchen", hebrew: "מטבח" },
            { english: "Little", hebrew: "קטן" },
            { english: "Living room", hebrew: "סלון" },
            { english: "Magic", hebrew: "קסם" },
            { english: "Meat", hebrew: "בשר" },
            { english: "Menu", hebrew: "תפריט" },
            { english: "Monkey", hebrew: "קוף" },
            { english: "Now", hebrew: "עכשיו" },
            { english: "Pink", hebrew: "ורוד" },
            { english: "Plane", hebrew: "מטוס" },
            { english: "Police", hebrew: "משטרה" },
            { english: "Potato", hebrew: "תפוח אדמה" },
            { english: "Rain", hebrew: "גשם" },
            { english: "Slowly", hebrew: "לאט" },
            { english: "Soup", hebrew: "מרק" },
            { english: "Station", hebrew: "תחנה" },
            { english: "Tomato", hebrew: "עגבנייה" },
            { english: "Train", hebrew: "רכבת" },
            { english: "Truck", hebrew: "משאית" },
            { english: "Wind", hebrew: "רוח" },
            { english: "Window", hebrew: "חלון" },
            { english: "Wolf", hebrew: "זאב" },
            { english: "Van", hebrew: "ואן" },
            { english: "Very", hebrew: "מאוד" },
            { english: "Wet", hebrew: "רטוב" },
            // Added words based on your request
            { english: "Under", hebrew: "מתחת" },
            { english: "Behind", hebrew: "מאחורי" },
            { english: "Next to", hebrew: "ליד" },
            { english: "In front of", hebrew: "לפני" },
            { english: "House", hebrew: "בית" },
            { english: "Food", hebrew: "אוכל" },
            { english: "Transport", hebrew: "תחבורה" }
        ];

        // --- Game State Variables ---
        let currentQuestions = []; // Array to hold the 10 questions for the current game
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestions = 10;

        // New variables for word repetition logic
        const recentWordsLimit = 30; // Do not repeat a word for this many questions in overall game history
        let recentWordsHistory = []; // Stores the last X English words displayed (English word string)
        const incorrectReviewCooldown = 10; // Incorrect words can re-appear after this many questions
        let incorrectWordsForReview = []; // Stores words that were answered incorrectly (full word object)

        // --- DOM Element References ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');

        const startButton = document.getElementById('start-button');
        const englishWordDisplay = document.getElementById('english-word');
        const speakerButton = document.getElementById('speaker-button');
        const answerButtonsContainer = document.getElementById('answer-buttons-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackMessage = document.getElementById('feedback-message');
        const progressDisplay = document.getElementById('progress-display');
        const scoreDisplay = document.getElementById('score-display');
        const finalScoreDisplay = document.getElementById('final-score');
        const endMessageDisplay = document.getElementById('end-message');
        const playAgainButton = document.getElementById('play-again-button');

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        speakerButton.addEventListener('click', speakWord);
        playAgainButton.addEventListener('click', startGame);

        // --- Helper Functions ---

        // Shuffles an array randomly (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Selects a pool of words for the current game session, respecting repetition rules
        function selectRandomQuestions() {
            let selectedForThisGame = [];
            let allAvailableWords = [...words]; // Clone to modify

            // 1. Prioritize words that were answered incorrectly, if their cooldown has passed
            let eligibleIncorrectWords = incorrectWordsForReview.filter(wordObj => 
                currentQuestionIndex - wordObj.lastShownIndex >= incorrectReviewCooldown && // Check cooldown
                !recentWordsHistory.includes(wordObj.english) // And not too recent overall
            );
            shuffleArray(eligibleIncorrectWords);

            // Add up to totalQuestions from eligibleIncorrectWords
            while (selectedForThisGame.length < totalQuestions && eligibleIncorrectWords.length > 0) {
                selectedForThisGame.push(eligibleIncorrectWords.shift());
            }

            // 2. Fill the rest of the questions from words not recently shown (general pool)
            let generalPool = allAvailableWords.filter(wordObj => 
                !recentWordsHistory.includes(wordObj.english) && // Not in recent history
                !selectedForThisGame.some(q => q.english === wordObj.english) // Not already selected
            );
            shuffleArray(generalPool);

            while (selectedForThisGame.length < totalQuestions && generalPool.length > 0) {
                selectedForThisGame.push(generalPool.shift());
            }

            // 3. Fallback: If still not enough unique words (e.g., small word list, strict rules), pick from remaining words
            // This is a safety net to ensure 10 questions are always available
            if (selectedForThisGame.length < totalQuestions) {
                let backupPool = allAvailableWords.filter(wordObj => 
                    !selectedForThisGame.some(q => q.english === wordObj.english)
                );
                shuffleArray(backupPool);
                while (selectedForThisGame.length < totalQuestions && backupPool.length > 0) {
                    selectedForThisGame.push(backupPool.shift());
                }
            }
            
            return selectedForThisGame;
        }

        // Generates 3 incorrect Hebrew answers for a given correct answer
        function generateIncorrectAnswers(correctHebrew) {
            const incorrectOptions = [];
            // Filter out the correct Hebrew word from all possible Hebrew words
            const allOtherHebrewWords = words.map(w => w.hebrew).filter(h => h !== correctHebrew);

            // Use a temporary history to avoid immediate repetition within the *same* set of options
            let tempUsedOptions = new Set([correctHebrew]); 

            // Shuffle the pool of other Hebrew words
            const shuffledOthers = shuffleArray(allOtherHebrewWords);

            for (let i = 0; i < shuffledOthers.length && incorrectOptions.length < 3; i++) {
                const candidate = shuffledOthers[i];
                if (!tempUsedOptions.has(candidate)) {
                    incorrectOptions.push(candidate);
                    tempUsedOptions.add(candidate);
                }
            }
            
            // Fallback if not enough unique incorrect options (e.g., very small vocabulary list)
            while (incorrectOptions.length < 3 && allOtherHebrewWords.length > incorrectOptions.length) {
                const randomIndex = Math.floor(Math.random() * allOtherHebrewWords.length);
                const candidate = allOtherHebrewWords[randomIndex];
                if (!tempUsedOptions.has(candidate)) {
                    incorrectOptions.push(candidate);
                    tempUsedOptions.add(candidate);
                }
            }

            return incorrectOptions;
        }

        // --- Game Flow Functions ---

        // Starts a new game
        function startGame() {
            // Reset state for a new game
            recentWordsHistory = []; 
            // incorrectWordsForReview is *not* reset here, as its purpose is to carry over words between games for review.
            // If you want it reset every time, uncomment the line below:
            // incorrectWordsForReview = []; 
            currentQuestionIndex = 0;
            score = 0;

            currentQuestions = selectRandomQuestions(); // Intelligently selects questions for the current game

            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex');

            displayQuestion();
        }

        // Displays the current question
        function displayQuestion() {
            // Clear feedback message and hide it
            feedbackMessage.textContent = '';
            feedbackMessage.style.opacity = '0'; // Hide with opacity for smooth transition
            feedbackMessage.classList.remove('correct-feedback', 'incorrect-feedback'); // Clear previous classes
            answerButtonsContainer.innerHTML = ''; // Clear previous buttons

            progressDisplay.textContent = `שאלה ${currentQuestionIndex + 1} מתוך ${totalQuestions}`;
            scoreDisplay.textContent = `ניקוד: ${score}`;

            const currentQuestion = currentQuestions[currentQuestionIndex];
            englishWordDisplay.textContent = currentQuestion.english;

            // Add current word to history (English string only) and manage its size
            recentWordsHistory.push(currentQuestion.english);
            if (recentWordsHistory.length > recentWordsLimit) {
                recentWordsHistory.shift(); // Remove oldest word if limit exceeded
            }
            
            // If this word was in incorrectWordsForReview, update its lastShownIndex
            const reviewWordEntry = incorrectWordsForReview.find(w => w.english === currentQuestion.english);
            if (reviewWordEntry) {
                reviewWordEntry.lastShownIndex = currentQuestionIndex;
            }

            speakWord();

            const correctHebrew = currentQuestion.hebrew;
            const incorrectHebrewOptions = generateIncorrectAnswers(correctHebrew);
            const allOptions = shuffleArray([correctHebrew, ...incorrectHebrewOptions]);

            allOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('answer-button');
                button.dataset.answer = option;
                button.addEventListener('click', handleAnswer);
                answerButtonsContainer.appendChild(button);
            });

            speakerButton.disabled = false;
        }

        // Handles user's answer selection
        function handleAnswer(event) {
            const selectedButton = event.target;
            const selectedAnswer = selectedButton.dataset.answer;
            const currentQuestion = currentQuestions[currentQuestionIndex];
            const correctHebrew = currentQuestion.hebrew;
            let delayTime = 0;

            // Disable all answer buttons
            Array.from(answerButtonsContainer.children).forEach(button => {
                button.disabled = true;
            });
            speakerButton.disabled = true;

            if (selectedAnswer === correctHebrew) {
                score++;
                feedbackMessage.textContent = 'נכון! 👏';
                feedbackMessage.classList.add('correct-feedback');
                selectedButton.classList.add('correct');
                delayTime = 1500; // 1.5 seconds for correct answer
                // Remove from incorrectWordsForReview if correctly answered now
                incorrectWordsForReview = incorrectWordsForReview.filter(w => w.english !== currentQuestion.english);
            } else {
                feedbackMessage.textContent = `לא בדיוק... התשובה הנכונה היא: ${correctHebrew}`;
                feedbackMessage.classList.add('incorrect-feedback');
                selectedButton.classList.add('incorrect');
                // Highlight the correct answer
                Array.from(answerButtonsContainer.children).forEach(button => {
                    if (button.dataset.answer === correctHebrew) {
                        button.classList.add('correct');
                    }
                });
                delayTime = 3000; // 3 seconds for incorrect answer

                // Add to incorrectWordsForReview if not already there, or update last incorrect attempt
                const existingIncorrect = incorrectWordsForReview.find(w => w.english === currentQuestion.english);
                if (!existingIncorrect) {
                    incorrectWordsForReview.push({ english: currentQuestion.english, hebrew: currentQuestion.hebrew, lastShownIndex: currentQuestionIndex });
                } else {
                    existingIncorrect.lastShownIndex = currentQuestionIndex; // Update timestamp
                }
            }

            scoreDisplay.textContent = `ניקוד: ${score}`;
            feedbackMessage.style.opacity = '1'; // Show feedback message

            setTimeout(nextQuestion, delayTime);
        }

        // Moves to the next question or ends the game
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < totalQuestions) {
                displayQuestion();
            } else {
                endGame();
            }
        }

        // Ends the game and displays summary with tailored and humorous feedback
        function endGame() {
            gameScreen.classList.add('hidden');
            gameScreen.classList.remove('flex');
            endScreen.classList.remove('hidden');
            endScreen.classList.add('flex');

            finalScoreDisplay.textContent = `צברת ${score} מתוך ${totalQuestions} נקודות!`;

            let message = '';
            if (score === totalQuestions) {
                message = 'וואו! את פשוט אלופה! המילים רוקדות בשבילך! 💃 איזה כישרון מדהים!';
            } else if (score >= 8) { // 8-9 correct
                message = 'נהדר! את מבינה מילים כמו קוסמת! ✨ המשיכי לתרגל ואף מילה לא תברח לך!';
            } else if (score >= 5) { // 5-7 correct
                message = 'יפה מאוד! את בדרך הנכונה! תרגול נוסף יהפוך אותך לכוכבת מילים אמיתית! 🌟 אלופה!';
            } else { // 0-4 correct
                message = 'ניסית יפה מאוד! כל התחלה קשה, אבל את חזקה ואנחנו נלמד ביחד! בואי ננסה שוב ונראה למילים מי הבוס! �';
            }
            endMessageDisplay.textContent = message;
        }

        // Speaks the English word using Web Speech API
        function speakWord() {
            const wordToSpeak = englishWordDisplay.textContent;
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(wordToSpeak);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
            } else {
                console.warn("Speech Synthesis API not supported in this browser.");
                if (feedbackMessage.style.opacity === '0') {
                    feedbackMessage.textContent = "המכשיר שלך לא תומך בהקראת מילים.";
                    feedbackMessage.classList.add('incorrect-feedback'); // Show in red as it's an error
                    feedbackMessage.style.opacity = '1';
                    setTimeout(() => {
                        feedbackMessage.style.opacity = '0';
                        feedbackMessage.classList.remove('incorrect-feedback');
                    }, 3000);
                }
            }
        }

        // Initialize the game on window load by showing the start screen
        window.onload = function() {
            startScreen.classList.remove('hidden');
            startScreen.classList.add('flex');
            gameScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
        };

    </script>
</body>
</html>
�
